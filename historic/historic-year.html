<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <title>Motosearch historic by year</title>
  <script src="https://code.highcharts.com/highcharts.js"></script>
</head>
<body>

<div id="chart"></div>

<script>
fetch('historic-year.json')
  .then(response => response.json())
  .then(json => {
    drawChart(json);
  });

function valuePoints(prices) {
  var points = [];

  for (var k in prices) {
    var dateParts = k.split('-');
    points.push([
      new Date(dateParts[0], dateParts[1]-1, dateParts[2]).getTime(),
      prices[k].averagePrice
    ]);
  }

  points = points.sort(function(a, b) {
    return a[0] - b[0];
  });
  return points;
}

function convertToChartSeries(json) {
  var series = [];
  for (var k in json) {
    series.push({
      name: k,
      data: valuePoints(json[k].prices)
    });
  }

  return series;
}

function drawChart(json) {
  var columns = convertToChartSeries(json);
  console.log(columns);

  Highcharts.chart('chart', {
      chart: {
          type: 'spline',
          height: 800
      },
      title: {
          text: 'BMW F800GT Prices by year'
      },
      subtitle: {
          text: 'Evolution of prices by year over time'
      },
      xAxis: {
          type: 'datetime',
          dateTimeLabelFormats: { // don't display the dummy year
              month: '%e. %b',
              year: '%b'
          },
          title: {
              text: 'Date'
          }
      },
      yAxis: {
          title: {
              text: 'Avg price (€)'
          }
      },
      tooltip: {
          headerFormat: '<b>{series.name}</b><br>',
          pointFormat: '{point.x:%e. %b}: {point.y:.0f}€'
      },

      plotOptions: {
          spline: {
              marker: {
                  enabled: true
              }
          }
      },

      series: columns
  });
}
</script>
</body>
</html>
